import { approve, stop, reject, abolish, reply, sign } from '../../services/assapi';
Page({
    app: getApp(),
    data: {
        comment: '',
        oper: '',
        node: '',
        rowData: {
            id: '',
            categoryid: '',
            isNeedApprover: 0,
        },
        msgShow: false,
        msgInfo: {
            type: '',
            title: '',
            desc: '',
        }
    },
    onAppendComment(e) {
        const { dataset: { text } } = e.target;
        const { comment } = this.data;
        const newComment = comment.concat(text);
        this.setData({
            comment: newComment,
        });
    },
    onNodeChange(event) {
        this.setData({
            node: event.detail,
        });
    },
    onRadioClick(event) {
        const { name } = event.currentTarget.dataset;
        this.setData({
            node: name,
        });
    },
    onApproveClick() {
        const that = this;
        const { rowData, comment, node } = that.data;
        if (rowData) {
            if (rowData.isNeedApprover === 1) {
                that.operateFail({
                    message: '暂时不支持选人',
                });
            }
            else {
                approve({
                    approvalId: rowData.id,
                    categoryid: rowData.categoryid,
                    comment: `${comment} (来自:微信小程序)`,
                    nextNode: node,
                }).then(that.operateSuccess)
                    .catch(that.operateFail);
            }
        }
    },
    onRejectClick() {
        const that = this;
        const { rowData, comment, node } = that.data;
        if (rowData) {
            reject({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
                rejectNode: node,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onStopClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            stop({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onSignClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            sign({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onAbolishClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            abolish({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onReplyClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            reply({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    operateSuccess(res) {
        const data = res.data;
        if (res.statusCode === 200) {
            if (data.status == 200) {
                wx.navigateBack({
                    delta: 2,
                });
            }
            else {
                this.operateFail({
                    message: data.errorMessage,
                });
            }
        }
        else {
            this.operateFail({
                message: data.message,
            });
        }
    },
    operateFail(res) {
        this.setData({
            msgShow: true,
            msgInfo: {
                type: 'error',
                title: '操作失败',
                desc: res.message,
            },
        });
    },
    bindMsgHide() {
        this.setData({
            msgShow: false,
        });
    },
    onLoad: function () {
        const that = this;
        const eventChannel = this.getOpenerEventChannel();
        eventChannel.on('acceptDataFromOpenerPage', function (data) {
            const { rowData, oper } = data;
            let node = '';
            if (oper === 'approve') {
                node = rowData && rowData.nextNode ? rowData.nextNode[0].id : '';
            }
            else if (oper === 'reject') {
                node = rowData && rowData.rejectNode ? rowData.rejectNode[0].id : '';
            }
            that.setData({
                rowData,
                oper,
                node,
            });
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVwRixJQUFJLENBQUM7SUFDSCxHQUFHLEVBQUUsTUFBTSxFQUFhO0lBSXhCLElBQUksRUFBRTtRQUNKLE9BQU8sRUFBRSxFQUFFO1FBQ1gsSUFBSSxFQUFFLEVBQUU7UUFDUixJQUFJLEVBQUUsRUFBRTtRQUNSLE9BQU8sRUFBRTtZQUNQLEVBQUUsRUFBRSxFQUFFO1lBQ04sVUFBVSxFQUFFLEVBQUU7WUFDZCxjQUFjLEVBQUUsQ0FBQztTQUNsQjtRQUNELE9BQU8sRUFBRSxLQUFLO1FBQ2QsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLEVBQUU7WUFDUixLQUFLLEVBQUUsRUFBRTtZQUNULElBQUksRUFBRSxFQUFFO1NBQ1Q7S0FDRjtJQUVELGVBQWUsQ0FBQyxDQUFNO1FBQ3BCLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxHQUl2QixDQUFDLENBQUMsTUFBTSxDQUFDO1FBRWIsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDOUIsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsT0FBTyxFQUFFLFVBQVU7U0FDcEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFVO1FBQ3JCLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxJQUFJLEVBQUUsS0FBSyxDQUFDLE1BQU07U0FDbkIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFVO1FBQ3JCLE1BQU0sRUFBRSxJQUFJ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RCxRQUFRLEVBQUU7SUFFVixDQUFDO0lBS0QsaUJBQWlCLEVBQUU7SUFFbkIsQ0FBQztJQUtELGFBQWEsRUFBRTtJQUVmLENBQUM7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIGltcG9ydCB7IHd4UmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3JlcXVlc3QnO1xuaW1wb3J0IHsgYXBwcm92ZSwgc3RvcCwgcmVqZWN0LCBhYm9saXNoLCByZXBseSwgc2lnbiB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2Fzc2FwaSc7XG5cblBhZ2Uoe1xuICBhcHA6IGdldEFwcDxCcG1PcHRpb24+KCksXG4gIC8qKlxuICAgKiDpobXpnaLnmoTliJ3lp4vmlbDmja5cbiAgICovXG4gIGRhdGE6IHtcbiAgICBjb21tZW50OiAnJyxcbiAgICBvcGVyOiAnJyxcbiAgICBub2RlOiAnJyxcbiAgICByb3dEYXRhOiB7XG4gICAgICBpZDogJycsXG4gICAgICBjYXRlZ29yeWlkOiAnJyxcbiAgICAgIGlzTmVlZEFwcHJvdmVyOiAwLFxuICAgIH0sXG4gICAgbXNnU2hvdzogZmFsc2UsXG4gICAgbXNnSW5mbzoge1xuICAgICAgdHlwZTogJycsXG4gICAgICB0aXRsZTogJycsXG4gICAgICBkZXNjOiAnJyxcbiAgICB9XG4gIH0sXG5cbiAgb25BcHBlbmRDb21tZW50KGU6IGFueSkge1xuICAgIGNvbnN0IHsgZGF0YXNldDogeyB0ZXh0IH0gfToge1xuICAgICAgZGF0YXNldDoge1xuICAgICAgICB0ZXh0OiBzdHJpbmc7XG4gICAgICB9XG4gICAgfSA9IGUudGFyZ2V0O1xuXG4gICAgY29uc3QgeyBjb21tZW50IH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgbmV3Q29tbWVudCA9IGNvbW1lbnQuY29uY2F0KHRleHQpO1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBjb21tZW50OiBuZXdDb21tZW50LFxuICAgIH0pO1xuICB9LFxuXG4gIG9uTm9kZUNoYW5nZShldmVudDogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG5vZGU6IGV2ZW50LmRldGFpbCxcbiAgICB9KTtcbiAgfSxcblxuICBvblJhZGlvQ2xpY2soZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IHsgbmFtZSB9ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0O1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBub2RlOiBuYW1lLFxuICAgIH0pO1xuICB9LFxuXG5cbiAgb25BcHByb3ZlQ2xpY2soKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgLy8gY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCBvcGVyIH0gPSB0aGF0LmRhdGE7XG4gICAgY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCBub2RlfSA9IHRoYXQuZGF0YVxuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIGlmKHJvd0RhdGEuaXNOZWVkQXBwcm92ZXIgPT09IDEpIHtcbiAgICAgICAgdGhhdC5vcGVyYXRlRmFpbCh7XG4gICAgICAgICAgbWVzc2FnZTogJ+aaguaXtuS4jeaUr+aMgemAieS6uicsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYXBwcm92ZSh7XG4gICAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgICBjYXRlZ29yeWlkOiByb3dEYXRhLmNhdGVnb3J5aWQsXG4gICAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgICAgICBuZXh0Tm9kZTogbm9kZSxcbiAgICAgICAgfSkudGhlbih0aGF0Lm9wZXJhdGVTdWNjZXNzKVxuICAgICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgb25SZWplY3RDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIG5vZGV9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIHJlamVjdCh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgICAgcmVqZWN0Tm9kZTogbm9kZSxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICBvblN0b3BDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgc3RvcCh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICBvblNpZ25DbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgc2lnbih7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNvbW1lbnQ6IGAke2NvbW1lbnR9ICjmnaXoh6o65b6u5L+h5bCP56iL5bqPKWAsXG4gICAgICB9KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG5cbiAgb25BYm9saXNoQ2xpY2soKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCB9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIGFib2xpc2goe1xuICAgICAgICBhcHByb3ZhbElkOiByb3dEYXRhLmlkLFxuICAgICAgICBjb21tZW50OiBgJHtjb21tZW50fSAo5p2l6IeqOuW+ruS/oeWwj+eoi+W6jylgLFxuICAgICAgfSkudGhlbih0aGF0Lm9wZXJhdGVTdWNjZXNzKVxuICAgICAgICAuY2F0Y2godGhhdC5vcGVyYXRlRmFpbCk7XG4gICAgfVxuICB9LFxuXG4gIG9uUmVwbHlDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgcmVwbHkoe1xuICAgICAgICBhcHByb3ZhbElkOiByb3dEYXRhLmlkLFxuICAgICAgICBjb21tZW50OiBgJHtjb21tZW50fSAo5p2l6IeqOuW+ruS/oeWwj+eoi+W6jylgLFxuICAgICAgfSkudGhlbih0aGF0Lm9wZXJhdGVTdWNjZXNzKVxuICAgICAgICAuY2F0Y2godGhhdC5vcGVyYXRlRmFpbCk7XG4gICAgfVxuICB9LFxuXG4gIG9wZXJhdGVTdWNjZXNzKHJlczogV2VjaGF0TWluaXByb2dyYW0uUmVxdWVzdFN1Y2Nlc3NDYWxsYmFja1Jlc3VsdCkge1xuICAgIGNvbnN0IGRhdGE6IGFueSA9IHJlcy5kYXRhO1xuICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAgICBpZiAoZGF0YS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgZGVsdGE6IDIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMub3BlcmF0ZUZhaWwoe1xuICAgICAgICAgIG1lc3NhZ2U6IGRhdGEuZXJyb3JNZXNzYWdlLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLm9wZXJhdGVGYWlsKHtcbiAgICAgICAgbWVzc2FnZTogZGF0YS5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIG9wZXJhdGVGYWlsKHJlczogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG1zZ1Nob3c6IHRydWUsXG4gICAgICBtc2dJbmZvOiB7XG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIHRpdGxlOiAn5pON5L2c5aSx6LSlJyxcbiAgICAgICAgZGVzYzogcmVzLm1lc3NhZ2UsXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuXG4gIGJpbmRNc2dIaWRlKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBtc2dTaG93OiBmYWxzZSxcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cbiAgICovXG4gIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IGV2ZW50Q2hhbm5lbCA9IHRoaXMuZ2V0T3BlbmVyRXZlbnRDaGFubmVsKCk7XG4gICAgLy8g55uR5ZCsYWNjZXB0RGF0YUZyb21PcGVuZXJQYWdl5LqL5Lu277yM6I635Y+W5LiK5LiA6aG16Z2i6YCa6L+HZXZlbnRDaGFubmVs5Lyg6YCB5Yiw5b2T5YmN6aG16Z2i55qE5pWw5o2uXG4gICAgZXZlbnRDaGFubmVsLm9uKCdhY2NlcHREYXRhRnJvbU9wZW5lclBhZ2UnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgY29uc3QgeyByb3dEYXRhLCBvcGVyIH06IHsgcm93RGF0YTogYW55OyBvcGVyOiBzdHJpbmc7IH0gPSBkYXRhO1xuICAgICAgbGV0IG5vZGUgPScnO1xuICAgICAgaWYob3BlciA9PT0gJ2FwcHJvdmUnKSB7XG4gICAgICAgIG5vZGUgPSByb3dEYXRhICYmIHJvd0RhdGEubmV4dE5vZGUgPyByb3dEYXRhLm5leHROb2RlWzBdLmlkIDogJyc7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKG9wZXIgPT09ICdyZWplY3QnKSB7XG4gICAgICAgIG5vZGUgPSByb3dEYXRhICYmIHJvd0RhdGEucmVqZWN0Tm9kZSA/IHJvd0RhdGEucmVqZWN0Tm9kZVswXS5pZCA6ICcnO1xuICAgICAgfVxuICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgcm93RGF0YSxcbiAgICAgICAgb3BlcixcbiAgICAgICAgbm9kZSxcbiAgICAgIH0pO1xuICAgIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAqL1xuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcbiAgICovXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHtcblxuICB9XG59KTsiXX0=