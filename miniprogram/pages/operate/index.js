import { approve, stop, reject, abolish, reply, sign, communicate, send, } from '../../services/assapi';
Page({
    app: getApp(),
    data: {
        comment: '',
        oper: '',
        node: '',
        rowData: {
            id: '',
            categoryid: '',
            isNeedApprover: 0,
        },
        msgShow: false,
        msgInfo: {
            type: '',
            title: '',
            desc: '',
        },
        toAccount: [],
        isCom: getApp().globalData.isCom,
    },
    onAppendComment(e) {
        const { dataset: { text } } = e.target;
        const { comment } = this.data;
        const newComment = comment.concat(text);
        this.setData({
            comment: newComment,
        });
    },
    onNodeChange(event) {
        this.setData({
            node: event.detail,
        });
    },
    onAccountChange(event) {
        this.setData({
            toAccount: event.detail,
        });
    },
    onRadioClick(event) {
        const { name } = event.currentTarget.dataset;
        this.setData({
            node: name,
        });
    },
    onAccountClick(_event) {
        const that = this;
        const { app } = that;
        if (app.globalData.isCom) {
            const accountList = that.data.toAccount;
            const selectedList = accountList.map(account => account.uaccount);
            wx.qy.selectEnterpriseContact({
                fromDepartmentId: -1,
                mode: "single",
                type: ["user"],
                selectedUserIds: selectedList,
                success: function (res) {
                    const newList = [];
                    var selectedUserList = res.result.userList;
                    for (var i = 0; i < selectedUserList.length; i++) {
                        const user = selectedUserList[i];
                        const userId = user.id;
                        const userName = user.name;
                        newList.push({
                            uaccount: userId,
                            accountName: userName,
                        });
                    }
                    that.setData({
                        toAccount: newList,
                    });
                }
            });
        }
    },
    onApproveClick() {
        const that = this;
        const { rowData, comment, node, isCom, toAccount, } = that.data;
        if (rowData) {
            if (rowData.isNeedApprover === 1 && toAccount.length === 0) {
                that.operateFail({
                    message: '必须选择发送对象',
                });
            }
            else {
                const request = {
                    approvalId: rowData.id,
                    categoryid: rowData.categoryid,
                    comment: `${comment} (来自:微信小程序)`,
                };
                if (node && node !== '') {
                    Object.assign(request, {
                        nextNode: node
                    });
                }
                if (toAccount.length > 0) {
                    Object.assign(request, {
                        nextApprovalUaccount: toAccount[0].uaccount,
                    });
                }
                approve(request).then(that.operateSuccess)
                    .catch(that.operateFail);
            }
        }
    },
    onRejectClick() {
        const that = this;
        const { rowData, comment, node } = that.data;
        if (rowData) {
            const request = {
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
            };
            if (node && node !== '') {
                Object.assign(request, {
                    rejectNode: node
                });
            }
            reject(request).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onStopClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            stop({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onSendClick() {
        const that = this;
        const { rowData, comment, toAccount, } = that.data;
        if (toAccount.length === 0) {
            that.operateFail({
                message: '必须选择发送对象',
            });
        }
        if (rowData) {
            send({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
                staff: toAccount[0].uaccount || '',
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onCommunicateClick() {
        const that = this;
        const { rowData, comment, toAccount, } = that.data;
        if (toAccount.length === 0) {
            that.operateFail({
                message: '必须选择发送对象',
            });
        }
        if (rowData) {
            communicate({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
                staff: toAccount[0].uaccount || '',
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onSignClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            sign({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onAbolishClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            abolish({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onReplyClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            reply({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    operateSuccess(res) {
        const data = res.data;
        if (res.statusCode === 200) {
            if (data.status == 200) {
                wx.navigateBack({
                    delta: 2,
                });
            }
            else {
                this.operateFail({
                    message: data.errorMessage,
                });
            }
        }
        else {
            this.operateFail({
                message: data.message,
            });
        }
    },
    operateFail(res) {
        this.setData({
            msgShow: true,
            msgInfo: {
                type: 'error',
                title: '操作失败',
                desc: res.message,
            },
        });
    },
    bindMsgHide() {
        this.setData({
            msgShow: false,
        });
    },
    onLoad: function () {
        const that = this;
        const eventChannel = this.getOpenerEventChannel();
        eventChannel.on('acceptDataFromOpenerPage', function (data) {
            const { rowData, oper } = data;
            let node = '';
            if (oper === 'approve') {
                node = rowData && rowData.nextNode && rowData.nextNode.length > 0 ? rowData.nextNode[0].id : '';
            }
            else if (oper === 'reject') {
                node = rowData && rowData.rejectNode && rowData.rejectNode.length > 0 ? rowData.rejectNode[0].id : '';
            }
            that.setData({
                rowData,
                oper,
                node,
            });
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUksR0FBRyxNQUFNLHVCQUF1QixDQUFDO0FBRXhHLElBQUksQ0FBQztJQUNILEdBQUcsRUFBRSxNQUFNLEVBQWE7SUFJeEIsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLEVBQUU7UUFDWCxJQUFJLEVBQUUsRUFBRTtRQUNSLElBQUksRUFBRSxFQUFFO1FBQ1IsT0FBTyxFQUFFO1lBQ1AsRUFBRSxFQUFFLEVBQUU7WUFDTixVQUFVLEVBQUUsRUFBRTtZQUNkLGNBQWMsRUFBRSxDQUFDO1NBQ2xCO1FBQ0QsT0FBTyxFQUFFLEtBQUs7UUFDZCxPQUFPLEVBQUU7WUFDUCxJQUFJLEVBQUUsRUFBRTtZQUNSLEtBQUssRUFBRSxFQUFFO1lBQ1QsSUFBSSxFQUFFLEVBQUU7U0FDVDtRQUNELFNBQVMsRUFBRSxFQUFtQjtRQUM5QixLQUFLLEVBQUUsTUFBTSxFQUFhLENBQUMsVUFBVSxDQUFDLEtBQUs7S0FDNUM7SUFFRCxlQUFlLENBQUMsQ0FBTTtRQUNwQixNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsR0FJdkIsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUViLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzlCLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLE9BQU8sRUFBRSxVQUFVO1NBQ3BCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxZQUFZLENBQUMsS0FBVTtRQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsSUFB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SUFLRCxRQUFRLEVBQUU7SUFFVixDQUFDO0lBS0QsaUJBQWlCLEVBQUU7SUFFbkIsQ0FBQztJQUtELGFBQWEsRUFBRTtJQUVmLENBQUM7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIGltcG9ydCB7IHd4UmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3JlcXVlc3QnO1xuaW1wb3J0IHsgYXBwcm92ZSwgc3RvcCwgcmVqZWN0LCBhYm9saXNoLCByZXBseSwgc2lnbiwgY29tbXVuaWNhdGUsIHNlbmQsIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYXNzYXBpJztcblxuUGFnZSh7XG4gIGFwcDogZ2V0QXBwPEJwbU9wdGlvbj4oKSxcbiAgLyoqXG4gICAqIOmhtemdoueahOWIneWni+aVsOaNrlxuICAgKi9cbiAgZGF0YToge1xuICAgIGNvbW1lbnQ6ICcnLFxuICAgIG9wZXI6ICcnLFxuICAgIG5vZGU6ICcnLFxuICAgIHJvd0RhdGE6IHtcbiAgICAgIGlkOiAnJyxcbiAgICAgIGNhdGVnb3J5aWQ6ICcnLFxuICAgICAgaXNOZWVkQXBwcm92ZXI6IDAsXG4gICAgfSxcbiAgICBtc2dTaG93OiBmYWxzZSxcbiAgICBtc2dJbmZvOiB7XG4gICAgICB0eXBlOiAnJyxcbiAgICAgIHRpdGxlOiAnJyxcbiAgICAgIGRlc2M6ICcnLFxuICAgIH0sXG4gICAgdG9BY2NvdW50OiBbXSBhcyBBY2NvdW50SW5mb1tdLFxuICAgIGlzQ29tOiBnZXRBcHA8QnBtT3B0aW9uPigpLmdsb2JhbERhdGEuaXNDb20sXG4gIH0sXG5cbiAgb25BcHBlbmRDb21tZW50KGU6IGFueSkge1xuICAgIGNvbnN0IHsgZGF0YXNldDogeyB0ZXh0IH0gfToge1xuICAgICAgZGF0YXNldDoge1xuICAgICAgICB0ZXh0OiBzdHJpbmc7XG4gICAgICB9XG4gICAgfSA9IGUudGFyZ2V0O1xuXG4gICAgY29uc3QgeyBjb21tZW50IH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgbmV3Q29tbWVudCA9IGNvbW1lbnQuY29uY2F0KHRleHQpO1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBjb21tZW50OiBuZXdDb21tZW50LFxuICAgIH0pO1xuICB9LFxuXG4gIG9uTm9kZUNoYW5nZShldmVudDogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG5vZGU6IGV2ZW50LmRldGFpbCxcbiAgICB9KTtcbiAgfSxcblxuICBvbkFjY291bnRDaGFuZ2UoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICB0b0FjY291bnQ6IGV2ZW50LmRldGFpbCxcbiAgICB9KTtcbiAgfSxcblxuICBvblJhZGlvQ2xpY2soZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IHsgbmFtZSB9ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0O1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBub2RlOiBuYW1lLFxuICAgIH0pO1xuICB9LFxuXG4gIG9uQWNjb3VudENsaWNrKF9ldmVudDogYW55KSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgeyBhcHAgfSA9IHRoYXQ7XG4gICAgaWYgKGFwcC5nbG9iYWxEYXRhLmlzQ29tKSB7XG4gICAgICBjb25zdCBhY2NvdW50TGlzdDogQWNjb3VudEluZm9bXSA9IHRoYXQuZGF0YS50b0FjY291bnQ7XG4gICAgICBjb25zdCBzZWxlY3RlZExpc3QgPSBhY2NvdW50TGlzdC5tYXAoYWNjb3VudCA9PiBhY2NvdW50LnVhY2NvdW50KTtcbiAgICAgIHd4LnF5LnNlbGVjdEVudGVycHJpc2VDb250YWN0KHtcbiAgICAgICAgZnJvbURlcGFydG1lbnRJZDogLTEsXG4gICAgICAgIG1vZGU6IFwic2luZ2xlXCIsXG4gICAgICAgIHR5cGU6IFtcInVzZXJcIl0sXG4gICAgICAgIHNlbGVjdGVkVXNlcklkczogc2VsZWN0ZWRMaXN0LFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzOiBhbnkpIHtcbiAgICAgICAgICBjb25zdCBuZXdMaXN0OiBBY2NvdW50SW5mb1tdID0gW107XG4gICAgICAgICAgdmFyIHNlbGVjdGVkVXNlckxpc3QgPSByZXMucmVzdWx0LnVzZXJMaXN0OyAvLyDlt7LpgInnmoTmiJDlkZjliJfooahcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdGVkVXNlckxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBzZWxlY3RlZFVzZXJMaXN0W2ldO1xuICAgICAgICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDsgLy8g5bey6YCJ55qE5Y2V5Liq5oiQ5ZGYSURcbiAgICAgICAgICAgIGNvbnN0IHVzZXJOYW1lID0gdXNlci5uYW1lOy8vIOW3sumAieeahOWNleS4quaIkOWRmOWQjeensFxuICAgICAgICAgICAgbmV3TGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgdWFjY291bnQ6IHVzZXJJZCxcbiAgICAgICAgICAgICAgYWNjb3VudE5hbWU6IHVzZXJOYW1lLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgICAgICB0b0FjY291bnQ6IG5ld0xpc3QsXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDpgJrov4co5ZCM5oSPKVxuICAgKi9cbiAgb25BcHByb3ZlQ2xpY2soKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCBub2RlLCBpc0NvbSwgdG9BY2NvdW50LCB9ID0gdGhhdC5kYXRhXG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgaWYgKHJvd0RhdGEuaXNOZWVkQXBwcm92ZXIgPT09IDEgJiYgdG9BY2NvdW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aGF0Lm9wZXJhdGVGYWlsKHtcbiAgICAgICAgICBtZXNzYWdlOiAn5b+F6aG76YCJ5oup5Y+R6YCB5a+56LGhJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdDogQXBwcm92ZVJlcXVlc3QgPSB7XG4gICAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgICBjYXRlZ29yeWlkOiByb3dEYXRhLmNhdGVnb3J5aWQsXG4gICAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZSAhPT0gJycpIHtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHJlcXVlc3QsIHtcbiAgICAgICAgICAgIG5leHROb2RlOiBub2RlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvQWNjb3VudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihyZXF1ZXN0LCB7XG4gICAgICAgICAgICBuZXh0QXBwcm92YWxVYWNjb3VudDogdG9BY2NvdW50WzBdLnVhY2NvdW50LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGFwcHJvdmUocmVxdWVzdCkudGhlbih0aGF0Lm9wZXJhdGVTdWNjZXNzKVxuICAgICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOmps+WbnijkuI3lkIzmhI8pXG4gICAqL1xuICBvblJlamVjdENsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgcm93RGF0YSwgY29tbWVudCwgbm9kZSB9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFJlamVjdFJlcXVlc3QgPSB7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgIH07XG4gICAgICBpZiAobm9kZSAmJiBub2RlICE9PSAnJykge1xuICAgICAgICBPYmplY3QuYXNzaWduKHJlcXVlc3QsIHtcbiAgICAgICAgICByZWplY3ROb2RlOiBub2RlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmVqZWN0KHJlcXVlc3QpLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICog5bqf5byDKOS4reatoilcbiAgICovXG4gIG9uU3RvcENsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgcm93RGF0YSwgY29tbWVudCwgfSA9IHRoYXQuZGF0YTtcblxuICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICBzdG9wKHtcbiAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgY2F0ZWdvcnlpZDogcm93RGF0YS5jYXRlZ29yeWlkLFxuICAgICAgICBjb21tZW50OiBgJHtjb21tZW50fSAo5p2l6IeqOuW+ruS/oeWwj+eoi+W6jylgLFxuICAgICAgfSkudGhlbih0aGF0Lm9wZXJhdGVTdWNjZXNzKVxuICAgICAgICAuY2F0Y2godGhhdC5vcGVyYXRlRmFpbCk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDovazlip5cbiAgICovXG4gIG9uU2VuZENsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgcm93RGF0YSwgY29tbWVudCwgdG9BY2NvdW50LCB9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHRvQWNjb3VudC5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoYXQub3BlcmF0ZUZhaWwoe1xuICAgICAgICBtZXNzYWdlOiAn5b+F6aG76YCJ5oup5Y+R6YCB5a+56LGhJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICBzZW5kKHtcbiAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgY2F0ZWdvcnlpZDogcm93RGF0YS5jYXRlZ29yeWlkLFxuICAgICAgICBjb21tZW50OiBgJHtjb21tZW50fSAo5p2l6IeqOuW+ruS/oeWwj+eoi+W6jylgLFxuICAgICAgICBzdGFmZjogdG9BY2NvdW50WzBdLnVhY2NvdW50IHx8ICcnLFxuICAgICAgICAvLyBzdGFmZjogJzEyNDg1JyxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICog5rKf6YCaXG4gICAqL1xuICBvbkNvbW11bmljYXRlQ2xpY2soKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCB0b0FjY291bnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAodG9BY2NvdW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhhdC5vcGVyYXRlRmFpbCh7XG4gICAgICAgIG1lc3NhZ2U6ICflv4XpobvpgInmi6nlj5HpgIHlr7nosaEnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIGNvbW11bmljYXRlKHtcbiAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgY2F0ZWdvcnlpZDogcm93RGF0YS5jYXRlZ29yeWlkLFxuICAgICAgICBjb21tZW50OiBgJHtjb21tZW50fSAo5p2l6IeqOuW+ruS/oeWwj+eoi+W6jylgLFxuICAgICAgICBzdGFmZjogdG9BY2NvdW50WzBdLnVhY2NvdW50IHx8ICcnLFxuICAgICAgICAvLyBzdGFmZjogJzEyNDg1JyxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICog562+5a2XXG4gICAqL1xuICBvblNpZ25DbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgc2lnbih7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNvbW1lbnQ6IGAke2NvbW1lbnR9ICjmnaXoh6o65b6u5L+h5bCP56iL5bqPKWAsXG4gICAgICB9KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiDlj5bmtojmsp/pgJpcbiAgICovXG4gIG9uQWJvbGlzaENsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgcm93RGF0YSwgY29tbWVudCwgfSA9IHRoYXQuZGF0YTtcblxuICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICBhYm9saXNoKHtcbiAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICog5Zue6KaG5rKf6YCaXG4gICAqL1xuICBvblJlcGx5Q2xpY2soKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCB9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIHJlcGx5KHtcbiAgICAgICAgYXBwcm92YWxJZDogcm93RGF0YS5pZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICBvcGVyYXRlU3VjY2VzcyhyZXM6IFdlY2hhdE1pbmlwcm9ncmFtLlJlcXVlc3RTdWNjZXNzQ2FsbGJhY2tSZXN1bHQpIHtcbiAgICBjb25zdCBkYXRhOiBhbnkgPSByZXMuZGF0YTtcbiAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuICAgICAgaWYgKGRhdGEuc3RhdHVzID09IDIwMCkge1xuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuICAgICAgICAgIGRlbHRhOiAyLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLm9wZXJhdGVGYWlsKHtcbiAgICAgICAgICBtZXNzYWdlOiBkYXRhLmVycm9yTWVzc2FnZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5vcGVyYXRlRmFpbCh7XG4gICAgICAgIG1lc3NhZ2U6IGRhdGEubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBvcGVyYXRlRmFpbChyZXM6IHsgbWVzc2FnZTogc3RyaW5nO30pIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgbXNnU2hvdzogdHJ1ZSxcbiAgICAgIG1zZ0luZm86IHtcbiAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgdGl0bGU6ICfmk43kvZzlpLHotKUnLFxuICAgICAgICBkZXNjOiByZXMubWVzc2FnZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG5cbiAgYmluZE1zZ0hpZGUoKSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG1zZ1Nob3c6IGZhbHNlLFxuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxuICAgKi9cbiAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgZXZlbnRDaGFubmVsID0gdGhpcy5nZXRPcGVuZXJFdmVudENoYW5uZWwoKTtcbiAgICAvLyDnm5HlkKxhY2NlcHREYXRhRnJvbU9wZW5lclBhZ2Xkuovku7bvvIzojrflj5bkuIrkuIDpobXpnaLpgJrov4dldmVudENoYW5uZWzkvKDpgIHliLDlvZPliY3pobXpnaLnmoTmlbDmja5cbiAgICBldmVudENoYW5uZWwub24oJ2FjY2VwdERhdGFGcm9tT3BlbmVyUGFnZScsIGZ1bmN0aW9uIChkYXRhOiBPcGVyYXRlUGFnZUNoYW5uZWwpIHtcbiAgICAgIGNvbnN0IHsgcm93RGF0YSwgb3BlciB9OiB7IHJvd0RhdGE6IGFueTsgb3Blcjogc3RyaW5nOyB9ID0gZGF0YTtcbiAgICAgIGxldCBub2RlID0gJyc7XG4gICAgICBpZiAob3BlciA9PT0gJ2FwcHJvdmUnKSB7XG4gICAgICAgIG5vZGUgPSByb3dEYXRhICYmIHJvd0RhdGEubmV4dE5vZGUgJiYgcm93RGF0YS5uZXh0Tm9kZS5sZW5ndGggPiAwID8gcm93RGF0YS5uZXh0Tm9kZVswXS5pZCA6ICcnO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAob3BlciA9PT0gJ3JlamVjdCcpIHtcbiAgICAgICAgbm9kZSA9IHJvd0RhdGEgJiYgcm93RGF0YS5yZWplY3ROb2RlICYmIHJvd0RhdGEucmVqZWN0Tm9kZS5sZW5ndGggPiAwID8gcm93RGF0YS5yZWplY3ROb2RlWzBdLmlkIDogJyc7XG4gICAgICB9XG4gICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICByb3dEYXRhLFxuICAgICAgICBvcGVyLFxuICAgICAgICBub2RlLFxuICAgICAgfSk7XG4gICAgfSlcbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcbiAgICovXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxuICAgKi9cbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICovXG4gIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XG4gICAqL1xuICBvblVubG9hZDogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouebuOWFs+S6i+S7tuWkhOeQhuWHveaVsC0t55uR5ZCs55So5oi35LiL5ouJ5Yqo5L2cXG4gICAqL1xuICBvblB1bGxEb3duUmVmcmVzaDogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuXG4gIH1cbn0pOyJdfQ==