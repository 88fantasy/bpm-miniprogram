import { approve, stop, reject, abolish, reply, sign, communicate, send, } from '../../services/assapi';
Page({
    app: getApp(),
    data: {
        comment: '',
        oper: '',
        node: '',
        rowData: {
            id: '',
            categoryid: '',
            isNeedApprover: 0,
        },
        msgShow: false,
        msgInfo: {
            type: '',
            title: '',
            desc: '',
        },
        toAccount: [],
        isCom: getApp().globalData.isCom,
    },
    onAppendComment(e) {
        const { dataset: { text } } = e.target;
        const { comment } = this.data;
        const newComment = comment.concat(text);
        this.setData({
            comment: newComment,
        });
    },
    onNodeChange(event) {
        this.setData({
            node: event.detail,
        });
    },
    onAccountChange(event) {
        this.setData({
            toAccount: event.detail,
        });
    },
    onRadioClick(event) {
        const { name } = event.currentTarget.dataset;
        this.setData({
            node: name,
        });
    },
    onAccountClick(_event) {
        const that = this;
        const { app } = that;
        if (app.globalData.isCom) {
            const accountList = that.data.toAccount;
            const selectedList = accountList.map(account => account.uaccount);
            wx.qy.selectEnterpriseContact({
                fromDepartmentId: -1,
                mode: "single",
                type: ["user"],
                selectedUserIds: selectedList,
                success: function (res) {
                    const newList = [];
                    var selectedUserList = res.result.userList;
                    for (var i = 0; i < selectedUserList.length; i++) {
                        const user = selectedUserList[i];
                        const userId = user.id;
                        const userName = user.name;
                        newList.push({
                            uaccount: userId,
                            accountName: userName,
                        });
                    }
                    that.setData({
                        toAccount: newList,
                    });
                }
            });
        }
    },
    onApproveClick() {
        const that = this;
        const { rowData, comment, node, toAccount, } = that.data;
        if (rowData) {
            if (rowData.isNeedApprover === 1 && toAccount.length === 0) {
                that.operateFail({
                    message: '必须选择发送对象',
                });
            }
            else {
                const request = {
                    approvalId: rowData.id,
                    categoryid: rowData.categoryid,
                    comment: `${comment} (来自:微信小程序)`,
                };
                if (node && node !== '') {
                    Object.assign(request, {
                        nextNode: node
                    });
                }
                if (toAccount.length > 0) {
                    Object.assign(request, {
                        nextApprovalUaccount: toAccount[0].uaccount,
                    });
                }
                approve(request).then(that.operateSuccess)
                    .catch(that.operateFail);
            }
        }
    },
    onRejectClick() {
        const that = this;
        const { rowData, comment, node } = that.data;
        if (rowData) {
            const request = {
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
            };
            if (node && node !== '') {
                Object.assign(request, {
                    rejectNode: node
                });
            }
            reject(request).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onStopClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            stop({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onSendClick() {
        const that = this;
        const { rowData, comment, toAccount, } = that.data;
        if (toAccount.length === 0) {
            that.operateFail({
                message: '必须选择发送对象',
            });
        }
        if (rowData) {
            send({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
                staff: toAccount[0].uaccount || '',
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onCommunicateClick() {
        const that = this;
        const { rowData, comment, toAccount, } = that.data;
        if (toAccount.length === 0) {
            that.operateFail({
                message: '必须选择发送对象',
            });
        }
        if (rowData) {
            communicate({
                approvalId: rowData.id,
                categoryid: rowData.categoryid,
                comment: `${comment} (来自:微信小程序)`,
                staff: toAccount[0].uaccount || '',
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onSignClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            sign({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onAbolishClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            abolish({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    onReplyClick() {
        const that = this;
        const { rowData, comment, } = that.data;
        if (rowData) {
            reply({
                approvalId: rowData.id,
                comment: `${comment} (来自:微信小程序)`,
            }).then(that.operateSuccess)
                .catch(that.operateFail);
        }
    },
    operateSuccess(res) {
        const data = res.data;
        if (res.statusCode === 200) {
            if (data.status == 200) {
                wx.navigateBack({
                    delta: 2,
                });
            }
            else {
                this.operateFail({
                    message: data.errorMessage,
                });
            }
        }
        else {
            this.operateFail({
                message: data.message,
            });
        }
    },
    operateFail(res) {
        this.setData({
            msgShow: true,
            msgInfo: {
                type: 'error',
                title: '操作失败',
                desc: res.message,
            },
        });
    },
    bindMsgHide() {
        this.setData({
            msgShow: false,
        });
    },
    onLoad: function () {
        const that = this;
        const eventChannel = this.getOpenerEventChannel();
        eventChannel.on('acceptDataFromOpenerPage', function (data) {
            const { rowData, oper } = data;
            let node = '';
            if (oper === 'approve') {
                node = rowData && rowData.nextNode && rowData.nextNode.length > 0 ? rowData.nextNode[0].id : '';
            }
            else if (oper === 'reject') {
                node = rowData && rowData.rejectNode && rowData.rejectNode.length > 0 ? rowData.rejectNode[0].id : '';
            }
            that.setData({
                rowData,
                oper,
                node,
            });
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUksR0FBRyxNQUFNLHVCQUF1QixDQUFDO0FBRXhHLElBQUksQ0FBQztJQUNILEdBQUcsRUFBRSxNQUFNLEVBQWE7SUFJeEIsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLEVBQUU7UUFDWCxJQUFJLEVBQUUsRUFBRTtRQUNSLElBQUksRUFBRSxFQUFFO1FBQ1IsT0FBTyxFQUFFO1lBQ1AsRUFBRSxFQUFFLEVBQUU7WUFDTixVQUFVLEVBQUUsRUFBRTtZQUNkLGNBQWMsRUFBRSxDQUFDO1NBQ2xCO1FBQ0QsT0FBTyxFQUFFLEtBQUs7UUFDZCxPQUFPLEVBQUU7WUFDUCxJQUFJLEVBQUUsRUFBRTtZQUNSLEtBQUssRUFBRSxFQUFFO1lBQ1QsSUFBSSxFQUFFLEVBQUU7U0FDVDtRQUNELFNBQVMsRUFBRSxFQUFtQjtRQUM5QixLQUFLLEVBQUUsTUFBTSxFQUFhLENBQUMsVUFBVSxDQUFDLEtBQUs7S0FDNUM7SUFFRCxlQUFlLENBQUMsQ0FBTTtRQUNwQixNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsR0FJdkIsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUViLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzlCLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLE9BQU8sRUFBRSxVQUFVO1NBQ3BCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxZQUFZLENBQUMsS0FBVTtRQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFNO1NBQ25CLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxlQUFlLENBQUMsS0FBVTtRQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsU0FBUyxFQUFFLEtBQUssQ0FBQyxNQUFNO1NBQ3hCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxZQUFZLENBQUMsS0FBVTtRQUNyQixNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUM7UUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGNBQWMsQ0FBQyxNQUFXO1FBQ3hCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUU7WUFDeEIsTUFBTSxXQUFXLEdBQWtCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3ZELE1BQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbEUsRUFBRSxDQUFDLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQztnQkFDNUIsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO2dCQUNwQixJQUFJLEVBQUUsUUFBUTtnQkFDZCxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUM7Z0JBQ2QsZUFBZSxFQUFFLFlBQVk7Z0JBQzdCLE9BQU8sRUFBRSxVQUFVLEdBQVE7b0JBQ3pCLE1BQU0sT0FBTyxHQUFrQixFQUFFLENBQUM7b0JBQ2xDLElBQUksZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7b0JBQzNDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0JBQ2hELE1BQU0sSUFBSSxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO3dCQUN2QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO3dCQUMzQixPQUFPLENBQUMsSUFBSSxDQUFDOzRCQUNYLFFBQVEsRUFBRSxNQUFNOzRCQUNoQixXQUFXLEVBQUUsUUFBUTt5QkFDdEIsQ0FBQyxDQUFDO3FCQUNKO29CQUNELElBQUksQ0FBQyxPQUFPLENBQUM7d0JBQ1gsU0FBUyxFQUFFLE9BQU87cUJBQ25CLENBQUMsQ0FBQTtnQkFDSixDQUFDO2FBQ0YsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBS0QsY0FBYztRQUNaLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQTtRQUV4RCxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksT0FBTyxDQUFDLGNBQWMsS0FBSyxDQUFDLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzFELElBQUksQ0FBQyxXQUFXLENBQUM7b0JBQ2YsT0FBTyxFQUFFLFVBQVU7aUJBQ3BCLENBQUMsQ0FBQzthQUNKO2lCQUNJO2dCQUNILE1BQU0sT0FBTyxHQUFtQjtvQkFDOUIsVUFBVSxFQUFFLE9BQU8sQ0FBQyxFQUFFO29CQUN0QixVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7b0JBQzlCLE9BQU8sRUFBRSxHQUFHLE9BQU8sYUFBYTtpQkFDakMsQ0FBQztnQkFDRixJQUFJLElBQUksSUFBSSxJQUFJLEtBQUssRUFBRSxFQUFFO29CQUN2QixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRTt3QkFDckIsUUFBUSxFQUFFLElBQUk7cUJBQ2YsQ0FBQyxDQUFDO2lCQUNKO2dCQUNELElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ3hCLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFO3dCQUNyQixvQkFBb0IsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUTtxQkFDNUMsQ0FBQyxDQUFDO2lCQUNKO2dCQUNELE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztxQkFDdkMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQzthQUM1QjtTQUNGO0lBQ0gsQ0FBQztJQUtELGFBQWE7UUFDWCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEIsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUU3QyxJQUFJLE9BQU8sRUFBRTtZQUNYLE1BQU0sT0FBTyxHQUFrQjtnQkFDN0IsVUFBVSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUN0QixVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7Z0JBQzlCLE9BQU8sRUFBRSxHQUFHLE9BQU8sYUFBYTthQUNqQyxDQUFDO1lBQ0YsSUFBSSxJQUFJLElBQUksSUFBSSxLQUFLLEVBQUUsRUFBRTtnQkFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7b0JBQ3JCLFVBQVUsRUFBRSxJQUFJO2lCQUNqQixDQUFDLENBQUM7YUFDSjtZQUNELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztpQkFDdEMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUM1QjtJQUNILENBQUM7SUFLRCxXQUFXO1FBQ1QsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUV4QyxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQztnQkFDSCxVQUFVLEVBQUUsT0FBTyxDQUFDLEVBQUU7Z0JBQ3RCLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtnQkFDOUIsT0FBTyxFQUFFLEdBQUcsT0FBTyxhQUFhO2FBQ2pDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztpQkFDekIsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUM1QjtJQUNILENBQUM7SUFLRCxXQUFXO1FBQ1QsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFNBQVMsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFbkQsSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUMxQixJQUFJLENBQUMsV0FBVyxDQUFDO2dCQUNmLE9BQU8sRUFBRSxVQUFVO2FBQ3BCLENBQUMsQ0FBQztTQUNKO1FBRUQsSUFBSSxPQUFPLEVBQUU7WUFDWCxJQUFJLENBQUM7Z0JBQ0gsVUFBVSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUN0QixVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7Z0JBQzlCLE9BQU8sRUFBRSxHQUFHLE9BQU8sYUFBYTtnQkFDaEMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksRUFBRTthQUVuQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUM7aUJBQ3pCLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBS0Qsa0JBQWtCO1FBQ2hCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBRW5ELElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDMUIsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDZixPQUFPLEVBQUUsVUFBVTthQUNwQixDQUFDLENBQUM7U0FDSjtRQUVELElBQUksT0FBTyxFQUFFO1lBQ1gsV0FBVyxDQUFDO2dCQUNWLFVBQVUsRUFBRSxPQUFPLENBQUMsRUFBRTtnQkFDdEIsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO2dCQUM5QixPQUFPLEVBQUUsR0FBRyxPQUFPLGFBQWE7Z0JBQ2hDLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLEVBQUU7YUFFbkMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO2lCQUN6QixLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQzVCO0lBQ0gsQ0FBQztJQUtELFdBQVc7UUFDVCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEIsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBRXhDLElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxDQUFDO2dCQUNILFVBQVUsRUFBRSxPQUFPLENBQUMsRUFBRTtnQkFDdEIsT0FBTyxFQUFFLEdBQUcsT0FBTyxhQUFhO2FBQ2pDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztpQkFDekIsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUM1QjtJQUNILENBQUM7SUFJRCxjQUFjO1FBQ1osTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUV4QyxJQUFJLE9BQU8sRUFBRTtZQUNYLE9BQU8sQ0FBQztnQkFDTixVQUFVLEVBQUUsT0FBTyxDQUFDLEVBQUU7Z0JBQ3RCLE9BQU8sRUFBRSxHQUFHLE9BQU8sYUFBYTthQUNqQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUM7aUJBQ3pCLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBS0QsWUFBWTtRQUNWLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFeEMsSUFBSSxPQUFPLEVBQUU7WUFDWCxLQUFLLENBQUM7Z0JBQ0osVUFBVSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUN0QixPQUFPLEVBQUUsR0FBRyxPQUFPLGFBQWE7YUFDakMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO2lCQUN6QixLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQzVCO0lBQ0gsQ0FBQztJQUVELGNBQWMsQ0FBQyxHQUFtRDtRQUNoRSxNQUFNLElBQUksR0FBUSxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQzNCLElBQUksR0FBRyxDQUFDLFVBQVUsS0FBSyxHQUFHLEVBQUU7WUFDMUIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLEdBQUcsRUFBRTtnQkFDdEIsRUFBRSxDQUFDLFlBQVksQ0FBQztvQkFDZCxLQUFLLEVBQUUsQ0FBQztpQkFDVCxDQUFDLENBQUM7YUFDSjtpQkFDSTtnQkFDSCxJQUFJLENBQUMsV0FBVyxDQUFDO29CQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsWUFBWTtpQkFDM0IsQ0FBQyxDQUFDO2FBQ0o7U0FDRjthQUNJO1lBQ0gsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87YUFDdEIsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBRUQsV0FBVyxDQUFDLEdBQXdCO1FBQ2xDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxPQUFPLEVBQUUsSUFBSTtZQUNiLE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUUsT0FBTztnQkFDYixLQUFLLEVBQUUsTUFBTTtnQkFDYixJQUFJLEVBQUUsR0FBRyxDQUFDLE9BQU87YUFDbEI7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxPQUFPLEVBQUUsS0FBSztTQUNmLENBQUMsQ0FBQztJQUNMLENBQUM7SUFLRCxNQUFNLEVBQUU7UUFDTixNQUFNLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFFbEQsWUFBWSxDQUFDLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxVQUFVLElBQXdCO1lBQzVFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQW9DLElBQUksQ0FBQztZQUNoRSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7WUFDZCxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7Z0JBQ3RCLElBQUksR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7YUFDakc7aUJBQ0ksSUFBSSxJQUFJLEtBQUssUUFBUSxFQUFFO2dCQUMxQixJQUFJLEdBQUcsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFVLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2FBQ3ZHO1lBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDWCxPQUFPO2dCQUNQLElBQUk7Z0JBQ0osSUFBSTthQUNMLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUtELE9BQU8sRUFBRTtJQUVULENBQUM7SUFLRCxNQUFNLEVBQUU7SUFFUixDQUFDO0lBS0QsTUFBTSxFQUFFO0lBRVIsQ0FBQztJQUtELFFBQVEsRUFBRTtJQUVWLENBQUM7SUFLRCxpQkFBaUIsRUFBRTtJQUVuQixDQUFDO0lBS0QsYUFBYSxFQUFFO0lBRWYsQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxuLy8gaW1wb3J0IHsgd3hSZXF1ZXN0IH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvcmVxdWVzdCc7XG5pbXBvcnQgeyBhcHByb3ZlLCBzdG9wLCByZWplY3QsIGFib2xpc2gsIHJlcGx5LCBzaWduLCBjb21tdW5pY2F0ZSwgc2VuZCwgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hc3NhcGknO1xuXG5QYWdlKHtcbiAgYXBwOiBnZXRBcHA8QnBtT3B0aW9uPigpLFxuICAvKipcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXG4gICAqL1xuICBkYXRhOiB7XG4gICAgY29tbWVudDogJycsXG4gICAgb3BlcjogJycsXG4gICAgbm9kZTogJycsXG4gICAgcm93RGF0YToge1xuICAgICAgaWQ6ICcnLFxuICAgICAgY2F0ZWdvcnlpZDogJycsXG4gICAgICBpc05lZWRBcHByb3ZlcjogMCxcbiAgICB9LFxuICAgIG1zZ1Nob3c6IGZhbHNlLFxuICAgIG1zZ0luZm86IHtcbiAgICAgIHR5cGU6ICcnLFxuICAgICAgdGl0bGU6ICcnLFxuICAgICAgZGVzYzogJycsXG4gICAgfSxcbiAgICB0b0FjY291bnQ6IFtdIGFzIEFjY291bnRJbmZvW10sXG4gICAgaXNDb206IGdldEFwcDxCcG1PcHRpb24+KCkuZ2xvYmFsRGF0YS5pc0NvbSxcbiAgfSxcblxuICBvbkFwcGVuZENvbW1lbnQoZTogYW55KSB7XG4gICAgY29uc3QgeyBkYXRhc2V0OiB7IHRleHQgfSB9OiB7XG4gICAgICBkYXRhc2V0OiB7XG4gICAgICAgIHRleHQ6IHN0cmluZztcbiAgICAgIH1cbiAgICB9ID0gZS50YXJnZXQ7XG5cbiAgICBjb25zdCB7IGNvbW1lbnQgfSA9IHRoaXMuZGF0YTtcbiAgICBjb25zdCBuZXdDb21tZW50ID0gY29tbWVudC5jb25jYXQodGV4dCk7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGNvbW1lbnQ6IG5ld0NvbW1lbnQsXG4gICAgfSk7XG4gIH0sXG5cbiAgb25Ob2RlQ2hhbmdlKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgbm9kZTogZXZlbnQuZGV0YWlsLFxuICAgIH0pO1xuICB9LFxuXG4gIG9uQWNjb3VudENoYW5nZShldmVudDogYW55KSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHRvQWNjb3VudDogZXZlbnQuZGV0YWlsLFxuICAgIH0pO1xuICB9LFxuXG4gIG9uUmFkaW9DbGljayhldmVudDogYW55KSB7XG4gICAgY29uc3QgeyBuYW1lIH0gPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG5vZGU6IG5hbWUsXG4gICAgfSk7XG4gIH0sXG5cbiAgb25BY2NvdW50Q2xpY2soX2V2ZW50OiBhbnkpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IGFwcCB9ID0gdGhhdDtcbiAgICBpZiAoYXBwLmdsb2JhbERhdGEuaXNDb20pIHtcbiAgICAgIGNvbnN0IGFjY291bnRMaXN0OiBBY2NvdW50SW5mb1tdID0gdGhhdC5kYXRhLnRvQWNjb3VudDtcbiAgICAgIGNvbnN0IHNlbGVjdGVkTGlzdCA9IGFjY291bnRMaXN0Lm1hcChhY2NvdW50ID0+IGFjY291bnQudWFjY291bnQpO1xuICAgICAgd3gucXkuc2VsZWN0RW50ZXJwcmlzZUNvbnRhY3Qoe1xuICAgICAgICBmcm9tRGVwYXJ0bWVudElkOiAtMSxcbiAgICAgICAgbW9kZTogXCJzaW5nbGVcIixcbiAgICAgICAgdHlwZTogW1widXNlclwiXSxcbiAgICAgICAgc2VsZWN0ZWRVc2VySWRzOiBzZWxlY3RlZExpc3QsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXM6IGFueSkge1xuICAgICAgICAgIGNvbnN0IG5ld0xpc3Q6IEFjY291bnRJbmZvW10gPSBbXTtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWRVc2VyTGlzdCA9IHJlcy5yZXN1bHQudXNlckxpc3Q7IC8vIOW3sumAieeahOaIkOWRmOWIl+ihqFxuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0ZWRVc2VyTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IHNlbGVjdGVkVXNlckxpc3RbaV07XG4gICAgICAgICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkOyAvLyDlt7LpgInnmoTljZXkuKrmiJDlkZhJRFxuICAgICAgICAgICAgY29uc3QgdXNlck5hbWUgPSB1c2VyLm5hbWU7Ly8g5bey6YCJ55qE5Y2V5Liq5oiQ5ZGY5ZCN56ewXG4gICAgICAgICAgICBuZXdMaXN0LnB1c2goe1xuICAgICAgICAgICAgICB1YWNjb3VudDogdXNlcklkLFxuICAgICAgICAgICAgICBhY2NvdW50TmFtZTogdXNlck5hbWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgICAgIHRvQWNjb3VudDogbmV3TGlzdCxcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOmAmui/hyjlkIzmhI8pXG4gICAqL1xuICBvbkFwcHJvdmVDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIG5vZGUsIHRvQWNjb3VudCwgfSA9IHRoYXQuZGF0YVxuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIGlmIChyb3dEYXRhLmlzTmVlZEFwcHJvdmVyID09PSAxICYmIHRvQWNjb3VudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhhdC5vcGVyYXRlRmFpbCh7XG4gICAgICAgICAgbWVzc2FnZTogJ+W/hemhu+mAieaLqeWPkemAgeWvueixoScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3Q6IEFwcHJvdmVSZXF1ZXN0ID0ge1xuICAgICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgICAgY2F0ZWdvcnlpZDogcm93RGF0YS5jYXRlZ29yeWlkLFxuICAgICAgICAgIGNvbW1lbnQ6IGAke2NvbW1lbnR9ICjmnaXoh6o65b6u5L+h5bCP56iL5bqPKWAsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUgIT09ICcnKSB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihyZXF1ZXN0LCB7XG4gICAgICAgICAgICBuZXh0Tm9kZTogbm9kZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0b0FjY291bnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVxdWVzdCwge1xuICAgICAgICAgICAgbmV4dEFwcHJvdmFsVWFjY291bnQ6IHRvQWNjb3VudFswXS51YWNjb3VudCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBhcHByb3ZlKHJlcXVlc3QpLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgICAuY2F0Y2godGhhdC5vcGVyYXRlRmFpbCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDpqbPlm54o5LiN5ZCM5oSPKVxuICAgKi9cbiAgb25SZWplY3RDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIG5vZGUgfSA9IHRoYXQuZGF0YTtcblxuICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICBjb25zdCByZXF1ZXN0OiBSZWplY3RSZXF1ZXN0ID0ge1xuICAgICAgICBhcHByb3ZhbElkOiByb3dEYXRhLmlkLFxuICAgICAgICBjYXRlZ29yeWlkOiByb3dEYXRhLmNhdGVnb3J5aWQsXG4gICAgICAgIGNvbW1lbnQ6IGAke2NvbW1lbnR9ICjmnaXoh6o65b6u5L+h5bCP56iL5bqPKWAsXG4gICAgICB9O1xuICAgICAgaWYgKG5vZGUgJiYgbm9kZSAhPT0gJycpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXF1ZXN0LCB7XG4gICAgICAgICAgcmVqZWN0Tm9kZTogbm9kZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJlamVjdChyZXF1ZXN0KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOW6n+W8gyjkuK3mraIpXG4gICAqL1xuICBvblN0b3BDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgc3RvcCh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgIH0pLnRoZW4odGhhdC5vcGVyYXRlU3VjY2VzcylcbiAgICAgICAgLmNhdGNoKHRoYXQub3BlcmF0ZUZhaWwpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICog6L2s5YqeXG4gICAqL1xuICBvblNlbmRDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIHRvQWNjb3VudCwgfSA9IHRoYXQuZGF0YTtcblxuICAgIGlmICh0b0FjY291bnQubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGF0Lm9wZXJhdGVGYWlsKHtcbiAgICAgICAgbWVzc2FnZTogJ+W/hemhu+mAieaLqeWPkemAgeWvueixoScsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgc2VuZCh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgICAgc3RhZmY6IHRvQWNjb3VudFswXS51YWNjb3VudCB8fCAnJyxcbiAgICAgICAgLy8gc3RhZmY6ICcxMjQ4NScsXG4gICAgICB9KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOayn+mAmlxuICAgKi9cbiAgb25Db21tdW5pY2F0ZUNsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgcm93RGF0YSwgY29tbWVudCwgdG9BY2NvdW50LCB9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHRvQWNjb3VudC5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoYXQub3BlcmF0ZUZhaWwoe1xuICAgICAgICBtZXNzYWdlOiAn5b+F6aG76YCJ5oup5Y+R6YCB5a+56LGhJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICBjb21tdW5pY2F0ZSh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgICAgY29tbWVudDogYCR7Y29tbWVudH0gKOadpeiHqjrlvq7kv6HlsI/nqIvluo8pYCxcbiAgICAgICAgc3RhZmY6IHRvQWNjb3VudFswXS51YWNjb3VudCB8fCAnJyxcbiAgICAgICAgLy8gc3RhZmY6ICcxMjQ4NScsXG4gICAgICB9KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOetvuWtl1xuICAgKi9cbiAgb25TaWduQ2xpY2soKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgY29uc3QgeyByb3dEYXRhLCBjb21tZW50LCB9ID0gdGhhdC5kYXRhO1xuXG4gICAgaWYgKHJvd0RhdGEpIHtcbiAgICAgIHNpZ24oe1xuICAgICAgICBhcHByb3ZhbElkOiByb3dEYXRhLmlkLFxuICAgICAgICBjb21tZW50OiBgJHtjb21tZW50fSAo5p2l6IeqOuW+ruS/oeWwj+eoi+W6jylgLFxuICAgICAgfSkudGhlbih0aGF0Lm9wZXJhdGVTdWNjZXNzKVxuICAgICAgICAuY2F0Y2godGhhdC5vcGVyYXRlRmFpbCk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog5Y+W5raI5rKf6YCaXG4gICAqL1xuICBvbkFib2xpc2hDbGljaygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCB7IHJvd0RhdGEsIGNvbW1lbnQsIH0gPSB0aGF0LmRhdGE7XG5cbiAgICBpZiAocm93RGF0YSkge1xuICAgICAgYWJvbGlzaCh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNvbW1lbnQ6IGAke2NvbW1lbnR9ICjmnaXoh6o65b6u5L+h5bCP56iL5bqPKWAsXG4gICAgICB9KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOWbnuimhuayn+mAmlxuICAgKi9cbiAgb25SZXBseUNsaWNrKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgcm93RGF0YSwgY29tbWVudCwgfSA9IHRoYXQuZGF0YTtcblxuICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICByZXBseSh7XG4gICAgICAgIGFwcHJvdmFsSWQ6IHJvd0RhdGEuaWQsXG4gICAgICAgIGNvbW1lbnQ6IGAke2NvbW1lbnR9ICjmnaXoh6o65b6u5L+h5bCP56iL5bqPKWAsXG4gICAgICB9KS50aGVuKHRoYXQub3BlcmF0ZVN1Y2Nlc3MpXG4gICAgICAgIC5jYXRjaCh0aGF0Lm9wZXJhdGVGYWlsKTtcbiAgICB9XG4gIH0sXG5cbiAgb3BlcmF0ZVN1Y2Nlc3MocmVzOiBXZWNoYXRNaW5pcHJvZ3JhbS5SZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrUmVzdWx0KSB7XG4gICAgY29uc3QgZGF0YTogYW55ID0gcmVzLmRhdGE7XG4gICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDApIHtcbiAgICAgIGlmIChkYXRhLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICBkZWx0YTogMixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5vcGVyYXRlRmFpbCh7XG4gICAgICAgICAgbWVzc2FnZTogZGF0YS5lcnJvck1lc3NhZ2UsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMub3BlcmF0ZUZhaWwoe1xuICAgICAgICBtZXNzYWdlOiBkYXRhLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgb3BlcmF0ZUZhaWwocmVzOiB7IG1lc3NhZ2U6IHN0cmluZzt9KSB7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIG1zZ1Nob3c6IHRydWUsXG4gICAgICBtc2dJbmZvOiB7XG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIHRpdGxlOiAn5pON5L2c5aSx6LSlJyxcbiAgICAgICAgZGVzYzogcmVzLm1lc3NhZ2UsXG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuXG4gIGJpbmRNc2dIaWRlKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBtc2dTaG93OiBmYWxzZSxcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cbiAgICovXG4gIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IGV2ZW50Q2hhbm5lbCA9IHRoaXMuZ2V0T3BlbmVyRXZlbnRDaGFubmVsKCk7XG4gICAgLy8g55uR5ZCsYWNjZXB0RGF0YUZyb21PcGVuZXJQYWdl5LqL5Lu277yM6I635Y+W5LiK5LiA6aG16Z2i6YCa6L+HZXZlbnRDaGFubmVs5Lyg6YCB5Yiw5b2T5YmN6aG16Z2i55qE5pWw5o2uXG4gICAgZXZlbnRDaGFubmVsLm9uKCdhY2NlcHREYXRhRnJvbU9wZW5lclBhZ2UnLCBmdW5jdGlvbiAoZGF0YTogT3BlcmF0ZVBhZ2VDaGFubmVsKSB7XG4gICAgICBjb25zdCB7IHJvd0RhdGEsIG9wZXIgfTogeyByb3dEYXRhOiBhbnk7IG9wZXI6IHN0cmluZzsgfSA9IGRhdGE7XG4gICAgICBsZXQgbm9kZSA9ICcnO1xuICAgICAgaWYgKG9wZXIgPT09ICdhcHByb3ZlJykge1xuICAgICAgICBub2RlID0gcm93RGF0YSAmJiByb3dEYXRhLm5leHROb2RlICYmIHJvd0RhdGEubmV4dE5vZGUubGVuZ3RoID4gMCA/IHJvd0RhdGEubmV4dE5vZGVbMF0uaWQgOiAnJztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKG9wZXIgPT09ICdyZWplY3QnKSB7XG4gICAgICAgIG5vZGUgPSByb3dEYXRhICYmIHJvd0RhdGEucmVqZWN0Tm9kZSAmJiByb3dEYXRhLnJlamVjdE5vZGUubGVuZ3RoID4gMCA/IHJvd0RhdGEucmVqZWN0Tm9kZVswXS5pZCA6ICcnO1xuICAgICAgfVxuICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgcm93RGF0YSxcbiAgICAgICAgb3BlcixcbiAgICAgICAgbm9kZSxcbiAgICAgIH0pO1xuICAgIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAqL1xuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAqL1xuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcbiAgICovXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHtcblxuICB9XG59KTsiXX0=