import { wxRequest } from '../../utils/request';
import { formatTime } from '../../utils/util';
Page({
    app: getApp(),
    data: {
        approvalid: '',
        rowData: {
            categoryid: [],
        },
        operation: [],
        detail: {
            content: [],
            record: [],
            attachment: [],
            steps: [],
            active: 0,
        },
    },
    onReturn() {
        wx.navigateBack({});
    },
    onAttachmentClick(e) {
        const { dataset: { url } } = e.target;
        if (url) {
            wx.downloadFile({
                url,
                success: function (res) {
                    const filePath = res.tempFilePath;
                    wx.openDocument({
                        filePath,
                        success: function (res) {
                            console.log('打开文档成功', res);
                        }
                    });
                },
                fail: function (res) {
                    console.log("download fail: ", res);
                }
            });
        }
    },
    onOperateClick(e) {
        const that = this;
        const { dataset: { operate } } = e.target;
        const { rowData } = this.data;
        if (rowData) {
            wx.navigateTo({
                url: `/pages/operate/index`,
                events: {
                    operateBack: function (data) {
                        wx.navigateBack({
                            success: () => {
                                const eventChannel = that.getOpenerEventChannel();
                                eventChannel.emit('detailBack', {
                                    promise: data.promise,
                                });
                            }
                        });
                    }
                },
                success: function (res) {
                    res.eventChannel.emit('acceptDataFromOpenerPage', {
                        rowData: rowData,
                        oper: operate,
                    });
                }
            });
        }
    },
    refreshDetail: function () {
        const { data: { approvalid, rowData }, app: { globalData: { accountInfo: { token } } } } = this;
        const that = this;
        wxRequest({
            header: {
                'content-type': 'application/x-www-form-urlencoded',
            },
            url: "/ass/assdetail",
            method: 'POST',
            data: {
                token,
                approvalid,
                categoryid: rowData.categoryid,
            }
        }).then((res) => {
            wx.hideLoading();
            if (res.statusCode == 200) {
                const data = res.data;
                const { record = [] } = data.data;
                let steps = [];
                let active = 0;
                record.map((item, index) => {
                    steps.push({
                        text: `${item.operator}(${item.checkmans}): ${item.comment}`,
                        desc: `${item.operatorNode}  ${item.time ? formatTime(new Date(item.time)) : "未审"}`
                    });
                    if (item.time) {
                        active = index;
                    }
                });
                that.setData({
                    detail: {
                        ...data.data,
                        steps,
                        active,
                    }
                });
            }
            else {
            }
        })
            .catch(() => {
            wx.hideLoading();
        });
    },
    onLoad: function () {
        const that = this;
        const eventChannel = this.getOpenerEventChannel();
        eventChannel.on('acceptDataFromOpenerPage', function (data) {
            const operation = data.rowData.operation;
            if (operation) {
                operation.map((item) => {
                    if (item.oper === 'approve') {
                        item.type = 'primary';
                    }
                    else if (item.oper === 'stop') {
                        item.type = 'danger';
                    }
                    else {
                        item.type = 'default';
                    }
                });
            }
            that.setData({
                ...data,
                operation,
            });
            that.refreshDetail();
        });
    },
    onPullDownRefresh() {
        this.refreshDetail();
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTlDLElBQUksQ0FBQztJQUNILEdBQUcsRUFBRSxNQUFNLEVBQWE7SUFDeEIsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFFLEVBQUU7UUFDZCxPQUFPLEVBQUU7WUFDUCxVQUFVLEVBQUcsRUFBRTtTQUNoQjtRQUNELFNBQVMsRUFBRSxFQUFFO1FBQ2IsTUFBTSxFQUFFO1lBQ04sT0FBTyxFQUFFLEVBQUU7WUFDWCxNQUFNLEVBQUUsRUFBRTtZQUNWLFVBQVUsRUFBRSxFQUFFO1lBQ2QsS0FBSyxFQUFFLEVBQUU7WUFDVCxNQUFNLEVBQUcsQ0FBQztTQUNYO0tBQ0Y7SUFFRCxRQUFRO1FBQ04sRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUVmLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxDQUFNO1FBQ3RCLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxHQUt0QixDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ2IsSUFBRyxHQUFHLEVBQUU7WUFDTixFQUFFLENBQUMsWUFBWSxDQUFDO2dCQUVkLEdBQUc7Z0JBQ0gsT0FBTyxFQUFFLFVBQVUsR0FBRztvQkFDcEIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQztvQkFDbEMsRUFBRSxDQUFDLFlBQVksQ0FBQzt3QkFDZCxRQUFRO3dCQUVSLE9BQU8sRUFBRSxVQUFVLEdBQUc7NEJBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFDLEdBQUcsQ0FBQyxDQUFDO3dCQUM1QixDQUFDO3FCQUNGLENBQUMsQ0FBQTtnQkFDSixDQUFDO2dCQUNELElBQUksRUFBQyxVQUFTLEdBQUc7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O0lBQ0osQ0FBQztJQUVELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDO0NBRUYsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW5kZXgudHNcbmltcG9ydCB7IHd4UmVxdWVzdCB9IGZyb20gJy4uLy4uL3V0aWxzL3JlcXVlc3QnO1xuaW1wb3J0IHsgZm9ybWF0VGltZSB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5QYWdlKHtcbiAgYXBwOiBnZXRBcHA8QnBtT3B0aW9uPigpLFxuICBkYXRhOiB7XG4gICAgYXBwcm92YWxpZDogJycsXG4gICAgcm93RGF0YTogeyBcbiAgICAgIGNhdGVnb3J5aWQgOiBbXSxcbiAgICB9LFxuICAgIG9wZXJhdGlvbjogW10sXG4gICAgZGV0YWlsOiB7XG4gICAgICBjb250ZW50OiBbXSxcbiAgICAgIHJlY29yZDogW10sXG4gICAgICBhdHRhY2htZW50OiBbXSxcbiAgICAgIHN0ZXBzOiBbXSxcbiAgICAgIGFjdGl2ZSA6IDAsXG4gICAgfSxcbiAgfSxcblxuICBvblJldHVybigpIHtcbiAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuXG4gICAgfSk7XG4gIH0sXG5cbiAgb25BdHRhY2htZW50Q2xpY2soZTogYW55KSB7XG4gICAgY29uc3QgeyBkYXRhc2V0OiB7IHVybCB9IH0gOiB7XG4gICAgICBkYXRhc2V0OiB7XG4gICAgICAgIHVybDogc3RyaW5nO1xuICAgICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICB9XG4gICAgfSA9IGUudGFyZ2V0O1xuICAgIGlmKHVybCkge1xuICAgICAgd3guZG93bmxvYWRGaWxlKHtcbiAgICAgICAgLy8g56S65L6LIHVybO+8jOW5tumdnuecn+WunuWtmOWcqFxuICAgICAgICB1cmwsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IHJlcy50ZW1wRmlsZVBhdGg7XG4gICAgICAgICAgd3gub3BlbkRvY3VtZW50KHtcbiAgICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgICAgLy8gZmlsZVR5cGU6IHR5cGUsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmiZPlvIDmlofmoaPmiJDlip8nLHJlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDpmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImRvd25sb2FkIGZhaWw6IFwiLHJlcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBvbk9wZXJhdGVDbGljayhlOmFueSkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IHsgZGF0YXNldDogeyBvcGVyYXRlIH0gfSA6IHtcbiAgICAgIGRhdGFzZXQ6IHtcbiAgICAgICAgb3BlcmF0ZTogc3RyaW5nO1xuICAgICAgfVxuICAgIH0gPSBlLnRhcmdldDtcblxuICAgIGNvbnN0IHsgcm93RGF0YSB9ID0gdGhpcy5kYXRhO1xuICAgIGlmKHJvd0RhdGEpIHtcbiAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICB1cmw6IGAvcGFnZXMvb3BlcmF0ZS9pbmRleGAsXG4gICAgICAgIGV2ZW50czoge1xuICAgICAgICAgIC8vIOS4uuaMh+WumuS6i+S7tua3u+WKoOS4gOS4quebkeWQrOWZqO+8jOiOt+WPluiiq+aJk+W8gOmhtemdouS8oOmAgeWIsOW9k+WJjemhtemdoueahOaVsOaNrlxuICAgICAgICAgIG9wZXJhdGVCYWNrOiBmdW5jdGlvbihkYXRhOiB7IFxuICAgICAgICAgICAgY29tbWVudDogc3RyaW5nO1xuICAgICAgICAgICAgb3Blcjogc3RyaW5nO1xuICAgICAgICAgICAgcHJvbWlzZTogUHJvbWlzZTxXZWNoYXRNaW5pcHJvZ3JhbS5SZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrUmVzdWx0PjtcbiAgICAgICAgICB9KSB7XG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuICAgICAgICAgICAgICBzdWNjZXNzOigpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudENoYW5uZWwgPSB0aGF0LmdldE9wZW5lckV2ZW50Q2hhbm5lbCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50Q2hhbm5lbC5lbWl0KCdkZXRhaWxCYWNrJywge1xuICAgICAgICAgICAgICAgICAgcHJvbWlzZTogZGF0YS5wcm9taXNlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAvLyDpgJrov4dldmVudENoYW5uZWzlkJHooqvmiZPlvIDpobXpnaLkvKDpgIHmlbDmja5cbiAgICAgICAgICByZXMuZXZlbnRDaGFubmVsLmVtaXQoJ2FjY2VwdERhdGFGcm9tT3BlbmVyUGFnZScsIHtcbiAgICAgICAgICAgIHJvd0RhdGE6IHJvd0RhdGEsXG4gICAgICAgICAgICBvcGVyOiBvcGVyYXRlLFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICB9LFxuXG4gIHJlZnJlc2hEZXRhaWw6IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB7IGRhdGE6IHsgYXBwcm92YWxpZCwgcm93RGF0YSB9LCBhcHA6IHsgZ2xvYmFsRGF0YTogeyBhY2NvdW50SW5mbyA6IHsgdG9rZW4gfSB9IH0gfSA9IHRoaXM7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgd3hSZXF1ZXN0KHtcbiAgICAgIGhlYWRlcjoge1xuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICB9LFxuICAgICAgdXJsOiBcIi9hc3MvYXNzZGV0YWlsXCIsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdG9rZW4sXG4gICAgICAgIGFwcHJvdmFsaWQsXG4gICAgICAgIGNhdGVnb3J5aWQ6IHJvd0RhdGEuY2F0ZWdvcnlpZCxcbiAgICAgIH1cbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT0gMjAwKSB7XG4gICAgICAgIGNvbnN0IGRhdGE6IGFueSA9IHJlcy5kYXRhO1xuXG4gICAgICAgIGNvbnN0IHsgcmVjb3JkID0gW10gfTogeyByZWNvcmQ6IEFycmF5PGFueT4gfSA9IGRhdGEuZGF0YTtcbiAgICAgICAgbGV0IHN0ZXBzOiB7IHRleHQ6IHN0cmluZzsgZGVzYzogc3RyaW5nOyB9W10gPSBbXTtcbiAgICAgICAgbGV0IGFjdGl2ZSA9IDA7XG4gICAgICAgIHJlY29yZC5tYXAoKGl0ZW0saW5kZXgpID0+IHtcbiAgICAgICAgICBzdGVwcy5wdXNoKHtcbiAgICAgICAgICAgIHRleHQ6IGAke2l0ZW0ub3BlcmF0b3J9KCR7aXRlbS5jaGVja21hbnN9KTogJHtpdGVtLmNvbW1lbnR9YCxcbiAgICAgICAgICAgIGRlc2M6IGAke2l0ZW0ub3BlcmF0b3JOb2RlfSAgJHtpdGVtLnRpbWU/IGZvcm1hdFRpbWUobmV3IERhdGUoaXRlbS50aW1lKSkgOiBcIuacquWuoVwifWBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZihpdGVtLnRpbWUpIHtcbiAgICAgICAgICAgIGFjdGl2ZSA9IGluZGV4O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgIGRldGFpbDoge1xuICAgICAgICAgICAgLi4uZGF0YS5kYXRhLFxuICAgICAgICAgICAgc3RlcHMsXG4gICAgICAgICAgICBhY3RpdmUsXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuXG4gICAgICB9XG4gICAgfSlcbiAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gICAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cbiAgICovXG4gIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIGNvbnN0IGV2ZW50Q2hhbm5lbCA9IHRoaXMuZ2V0T3BlbmVyRXZlbnRDaGFubmVsKCk7XG4gICAgLy8g55uR5ZCsYWNjZXB0RGF0YUZyb21PcGVuZXJQYWdl5LqL5Lu277yM6I635Y+W5LiK5LiA6aG16Z2i6YCa6L+HZXZlbnRDaGFubmVs5Lyg6YCB5Yiw5b2T5YmN6aG16Z2i55qE5pWw5o2uXG4gICAgZXZlbnRDaGFubmVsLm9uKCdhY2NlcHREYXRhRnJvbU9wZW5lclBhZ2UnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgY29uc3Qgb3BlcmF0aW9uOiBbXSA9IGRhdGEucm93RGF0YS5vcGVyYXRpb247XG4gICAgICBpZiAob3BlcmF0aW9uKSB7XG4gICAgICAgIG9wZXJhdGlvbi5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgIGlmIChpdGVtLm9wZXIgPT09ICdhcHByb3ZlJykge1xuICAgICAgICAgICAgaXRlbS50eXBlID0gJ3ByaW1hcnknO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmIChpdGVtLm9wZXIgPT09ICdzdG9wJykge1xuICAgICAgICAgICAgaXRlbS50eXBlID0gJ2Rhbmdlcic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaXRlbS50eXBlID0gJ2RlZmF1bHQnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIG9wZXJhdGlvbixcbiAgICAgIH0pO1xuICAgICAgdGhhdC5yZWZyZXNoRGV0YWlsKCk7XG4gICAgfSlcbiAgfSxcblxuICBvblB1bGxEb3duUmVmcmVzaCgpIHtcbiAgICB0aGlzLnJlZnJlc2hEZXRhaWwoKTtcbiAgfVxuXG59KSJdfQ==